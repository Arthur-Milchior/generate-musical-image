class ProgressionTest(unittest.TestCase):
    maxDiff = None
    d_min_7 = TwoHandsChord("ii",
                            left_hand=SetOfNotes([
                                Note.from_name("D3"),
                            ]),
                            right_hand=SetOfNotes([
                                Note.from_name("F4"),
                                Note.from_name("C5"),
                            ]),
                            tonic=Note.from_name("C")
                            )
    e_min_7 = TwoHandsChord("ii",
                            left_hand=SetOfNotes([
                                Note.from_name("E3"),
                            ]),
                            right_hand=SetOfNotes([
                                Note.from_name("G4"),
                                Note.from_name("D5"),
                            ]),
                            tonic=Note.from_name("D")
                            )
    three_five_c = ChordProgression(
        progression_name="ii V I", disambiguation="ii V I",
        key=Note.from_name("C"),
        chords=[
            d_min_7,
            TwoHandsChord("V",
                          left_hand=SetOfNotes([
                              Note.from_name("G3"),
                          ]),
                          right_hand=SetOfNotes([
                              Note.from_name("F4"),
                              Note.from_name("B4"),
                          ]),
                          tonic=Note.from_name("C")
                          ),
            TwoHandsChord("I",
                          left_hand=SetOfNotes([
                              Note.from_name("C3"),
                          ]),
                          right_hand=SetOfNotes([
                              Note.from_name("E4"),
                              Note.from_name("B4"),
                          ]),
                          tonic=Note.from_name("C")
                          ),
        ]
    )
    three_five_d = ChordProgression(
        progression_name="ii V I", disambiguation="ii V I",
        key=Note.from_name("D"),
        chords=[
            e_min_7,
            TwoHandsChord("V",
                          left_hand=SetOfNotes([
                              Note.from_name("A3"),
                          ]),
                          right_hand=SetOfNotes([
                              Note.from_name("G4"),
                              Note.from_name("C#5"),
                          ]),
                          tonic=Note.from_name("D")
                          ),
            TwoHandsChord("I",
                          left_hand=SetOfNotes([
                              Note.from_name("D3"),
                          ]),
                          right_hand=SetOfNotes([
                              Note.from_name("F#4"),
                              Note.from_name("C#5"),
                          ]),
                          tonic=Note.from_name("D")
                          ),
        ]
    )

    mini = """\
\\version "2.20.0"
<<
\\new Lyrics {\\lyricmode{ii}}
\\new Staff {c''}
>>
"""

    three_five_c_lily = """\
\\version "2.20.0"
\\score{
  <<
    \\new Lyrics {
      \\lyricmode{
        ii V I
      }
    }
    \\new PianoStaff<<
      \\new Staff{
        \\override Staff.TimeSignature.stencil = ##f
        \\omit Staff.BarLine
        \\omit PianoStaff.SpanBar
        \\time 30/4
        \\clef treble
        \\key c \\major
        <f' c''> <f' b'> <e' b'>
      }
      \\new Staff{
        \\clef bass
        \\key c \\major
        <d> <g> <c>
      }
    >>
  >>
}"""

    right_lily = """<f' c''> <f' b'> <e' b'>"""

    def test_right(self):
        self.assertEqual(self.right_lily, self.three_five_c.right_lily())

    def test_lyrics(self):
        self.assertEqual("ii V I", self.three_five_c.annotations_lily())

    def test_lily(self):
        self.assertEqual(
            self.three_five_c.lily(),
            self.three_five_c_lily
        )

    def test_file(self):
        prefix = f"{test_folder}/test"
        compile_(self.three_five_c_lily, prefix, wav=False, force_recompile=True)()

    def test_mini(self):
        prefix = f"{test_folder}/test"
        compile_(self.mini, prefix, wav=False, force_recompile=True)()

    def test_add(self):
        s = self.d_min_7 + Interval.make(chromatic=2, diatonic=1)
        self.assertEqual(s, self.e_min_7)
        s = self.three_five_c + Interval.make(chromatic=2, diatonic=1)
        print(s)
        print(self.three_five_d)
        self.assertEqual(s, self.three_five_d)
